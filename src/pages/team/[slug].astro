---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { teamMembers } from '../../data/team';

export async function getStaticPaths() {
  return teamMembers.map((member) => ({
    params: { slug: member.slug },
    props: { member },
  }));
}

const { member } = Astro.props;

// Build SEO-friendly description
const seoDescription = member.fullBio 
  ? `${member.name} - ${member.title} at Wright Wellness. ${member.fullBio.substring(0, 120)}...`
  : `${member.name} - ${member.title} at Wright Wellness. ${member.bio}`;

// Build canonical URL
const canonicalUrl = `/team/${member.slug}`;

// Build OG image (use member image if available, otherwise logo)
const ogImage = member.image ? `https://wrightwellness.me${member.image}` : 'https://wrightwellness.me/logo.jpg';
---

<BaseLayout 
  title={member.name} 
  description={seoDescription}
  canonicalUrl={canonicalUrl}
  ogImage={ogImage}
  ogType="profile"
>
  <div class="container mx-auto px-4 py-16">
    <div class="max-w-6xl mx-auto">
      <!-- Header Section -->
      <div class="flex flex-col md:flex-row items-center md:items-start gap-8 mb-12">
        {member.image ? (
          <div class="w-48 h-48 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden bg-primary-light shadow-lg ring-4 ring-primary-light/20">
            <img 
              src={member.image} 
              alt={member.name}
              loading="lazy"
              class="w-full h-full object-cover scale-110 object-[center_10%]"
            />
          </div>
        ) : (
          <div class="w-48 h-48 bg-primary-light rounded-full flex items-center justify-center flex-shrink-0 shadow-lg ring-4 ring-primary-light/20">
            <span class="text-6xl text-primary font-heading font-bold">
              {member.name.split(' ').map(n => n[0]).join('')}
            </span>
          </div>
        )}
        <div class="text-center md:text-left flex-1">
          <h1 class="text-4xl font-heading font-bold mb-2 text-neutral-dark">{member.name}</h1>
          <p class="text-xl text-primary mb-2">{member.title}</p>
          {member.pronouns && (
            <p class="text-neutral-dark text-sm italic mb-4">{member.pronouns}</p>
          )}
          {member.foundedYear && (
            <p class="text-neutral-dark text-base font-medium italic">
              founded Wright Wellness in {member.foundedYear}
            </p>
          )}
          {member.withWrightWellnessSince && (
            <p class="text-neutral-dark text-base font-medium italic">
              with Wright Wellness since {member.withWrightWellnessSince}
            </p>
          )}
          {member.notAcceptingClients && (
            <p class="text-red-600 text-sm font-semibold mt-2 italic">
              Please note, {member.name} is not currently accepting new clients.
            </p>
          )}
        </div>
      </div>

      <!-- Main Content Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Column: Main Bio Content -->
        <div class="lg:col-span-2 space-y-8">
          {member.fullBio && (
            <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-100">
              <div class="prose prose-lg max-w-none text-neutral-dark">
                {member.fullBio.split('\n\n').map((paragraph) => (
                  <p class="text-lg leading-relaxed mb-4">{paragraph}</p>
                ))}
              </div>
            </div>
          )}

          {!member.fullBio && (
            <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-100">
              <p class="text-neutral-dark text-lg leading-relaxed">{member.bio}</p>
            </div>
          )}

          {member.specialSections && member.specialSections.length > 0 && (
            <div class="space-y-6">
              {member.specialSections.map((section) => (
                <div class="bg-gradient-to-br from-primary-light/10 to-primary/5 rounded-lg p-6 border-l-4 border-primary">
                  <h3 class="text-xl font-heading font-bold text-neutral-dark mb-3">{section.title}</h3>
                  <div class="text-neutral-dark text-lg leading-relaxed whitespace-pre-line">
                    {section.content}
                  </div>
                </div>
              ))}
            </div>
          )}
        </div>

        <!-- Right Column: Quick Info Sidebar -->
        <div class="lg:col-span-1">
          <div class="sticky top-24 space-y-6">
            {member.notAcceptingClients && (
              <div class="bg-red-50 border-l-4 border-red-500 rounded-lg p-4">
                <p class="text-red-800 text-sm font-semibold">
                  ⚠️ Not Currently Accepting New Clients
                </p>
              </div>
            )}
            {member.specialties && member.specialties.length > 0 && (
              <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-100">
                <h2 class="text-xl font-heading font-semibold text-neutral-dark mb-4 flex items-center">
                  <span class="w-1 h-6 bg-primary rounded-full mr-3"></span>
                  Areas of Specialty
                </h2>
                <div class="flex flex-wrap gap-2">
                  {member.specialties.map((specialty) => (
                    <span class="inline-block px-3 py-1.5 bg-primary-light/30 text-neutral-dark rounded-full text-sm font-medium hover:bg-primary-light/50 transition-colors">
                      {specialty}
                    </span>
                  ))}
                </div>
              </div>
            )}

            {member.insurancePlans && member.insurancePlans.length > 0 && (
              <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-100">
                <h2 class="text-xl font-heading font-semibold text-neutral-dark mb-4 flex items-center">
                  <span class="w-1 h-6 bg-secondary rounded-full mr-3"></span>
                  Insurance Plans Accepted
                </h2>
                <div class="flex flex-wrap gap-2">
                  {member.insurancePlans.map((plan) => (
                    <span class="inline-block px-3 py-1.5 bg-secondary/10 text-secondary rounded-full text-sm font-medium border border-secondary/20 hover:bg-secondary/20 transition-colors">
                      {plan}
                    </span>
                  ))}
                </div>
              </div>
            )}

            {member.fees && member.fees.length > 0 && (
              <div class="bg-white rounded-lg p-6 shadow-sm border border-gray-100">
                <h2 class="text-xl font-heading font-semibold text-neutral-dark mb-4 flex items-center">
                  <span class="w-1 h-6 bg-primary rounded-full mr-3"></span>
                  Services & Fees
                </h2>
                {member.serviceDescription && (
                  <p class="text-sm text-neutral-dark mb-4">{member.serviceDescription}</p>
                )}
                <div class="space-y-3">
                  {member.fees.map((fee) => (
                    <div class="flex justify-between items-start gap-4 pb-3 border-b border-gray-100 last:border-0">
                      <div class="flex-1">
                        <span class="text-sm text-neutral-dark">
                          {fee.note && <span class="text-primary font-semibold">{fee.note}</span>}
                          {fee.service}
                        </span>
                      </div>
                      <span class="text-sm font-semibold text-primary whitespace-nowrap">{fee.price}</span>
                    </div>
                  ))}
                </div>
                {member.serviceNotes && member.serviceNotes.length > 0 && (
                  <div class="mt-4 pt-4 border-t border-gray-100 space-y-2">
                    {member.serviceNotes.map((note) => (
                      <p class="text-xs text-neutral-dark leading-relaxed">{note}</p>
                    ))}
                  </div>
                )}
              </div>
            )}
          </div>
        </div>
      </div>
      
      <div class="mt-12 pt-8 border-t border-gray-200">
        <a href="/team" class="text-primary hover:underline font-semibold inline-flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          Back to Team
        </a>
      </div>
    </div>
  </div>

  <!-- Person Schema for SEO -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "Person",
    "name": member.name,
    "jobTitle": member.title,
    "worksFor": {
      "@type": "MedicalOrganization",
      "name": "Wright Wellness",
      "address": {
        "@type": "PostalAddress",
        "streetAddress": "1398 W. Mayfield Rd., Suite 220",
        "addressLocality": "Arlington",
        "addressRegion": "TX",
        "postalCode": "76015",
        "addressCountry": "US"
      }
    },
    "url": `https://wrightwellness.me/team/${member.slug}`,
    "image": member.image ? `https://wrightwellness.me${member.image}` : undefined,
    "description": member.fullBio || member.bio,
    ...(member.specialties && member.specialties.length > 0 && {
      "knowsAbout": member.specialties
    })
  })} />
</BaseLayout>

